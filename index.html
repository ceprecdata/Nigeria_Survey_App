<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script>
  (async () => {
    const filesToCache = [
      './shinylive/webr/vfs/usr/lib/R/library/translations/DESCRIPTION',
      './shinylive/webr/vfs/usr/lib/R/library/translations/Meta/package.rds',
      './shinylive/webr/vfs/usr/lib/R/library/translations/R/translations.rdb',
      './shinylive/webr/vfs/usr/lib/R/library/translations/R/translations.rdx'
    ];
    
    console.log("Forcing HTTP Disk Cache for synchronous R files...");
    await Promise.all(filesToCache.map(url => fetch(url, { cache: "force-cache" })));
    console.log("Offline safety net deployed.");
  })();
</script>
    <title>Nigeria Survey App</title>

    <script type="module">
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./shinylive-sw.js', { scope: './' })
            .then(reg => console.log('Service Worker Registered'))
            .catch(err => console.log('Service Worker Failed', err));
        });
      }
    </script>

    <link rel="stylesheet" href="./shinylive/style-resets.css" />
    <link rel="stylesheet" href="./shinylive/shinylive.css" />
    <link rel="manifest" href="./manifest.json">
  </head>
  
  <body>
    <div style="height: 100vh; width: 100vw" id="root"></div>

    <script type="module">
      import { runExportedApp } from "./shinylive/shinylive.js";

      // This ensures the DOM is 100% ready before starting R
      window.addEventListener('DOMContentLoaded', () => {
runExportedApp({
  id: "root",
  appEngine: "r",
  relPath: "./",             // Vital: Tells it to look in the current folder
  serviceWorkerScope: "./",  // Vital: Keeps the "Librarian" focused on this folder
});
      });
    </script>
  </body>
</html>